<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Learn OAuth 2.0, Deuterium">
    <meta name="description" content="
说起OAuth，大多数人都听说过，有的还在工作中用到过。OAuth可以用来保护资源，尤其是API。不过当深入OAuth并仔细看看的时候，原来OAuth有很多值得讨论以及注意地方。这篇文章是《OAuth 2 In Action》的阅读笔记与">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Learn OAuth 2.0 | Deuterium</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <script src="/libs/jquery/jquery.min.js"></script>
    
<link rel="alternate" href="/atom.xml" title="Deuterium" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Deuterium</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Home</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="https://valineliu.gitbook.io/deuterium-wiki/" target="_blank" rel="noopener" class="waves-effect waves-light">
      
      <i class="fab fa-wikipedia-w" style="zoom: 0.6;"></i>
      
      <span>Wiki</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Deuterium</div>
        <div class="logo-desc">
            
            Software and anecdotes.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Home
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="https://valineliu.gitbook.io/deuterium-wiki/" target="_blank" rel="noopener" class="waves-effect waves-light">
			
			    <i class="fa-fw fab fa-wikipedia-w"></i>
			
			Wiki
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        
    </ul>
</div>

        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/5.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        Learn OAuth 2.0
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #3B5998;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #3B5998;
    }

    #toc-content .is-active-link::before {
        background-color: #3B5998;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/oauth/">
                                <span class="chip bg-color">oauth</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/security/" class="post-category">
                                security
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2020-10-30
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    5.7k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp;
                    19 Min
                </div>
                
				
                
            </div>
            
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<p>说起OAuth，大多数人都听说过，有的还在工作中用到过。OAuth可以用来保护资源，尤其是API。不过当深入OAuth并仔细看看的时候，原来OAuth有很多值得讨论以及注意地方。这篇文章是《OAuth 2 In Action》的阅读笔记与总结。</p>
</blockquote>
<h2 id="0x00-从一些实际场景开始"><a href="#0x00-从一些实际场景开始" class="headerlink" title="0x00 从一些实际场景开始"></a>0x00 从一些实际场景开始</h2><p>生活中会遇到一些场景，在这些场景下我们作为一些服务的用户需要授权别人来代替我们做一些事情。比如：</p>
<ul>
<li>开车到一个地方之后，可能需要别人代替自己把车泊好；</li>
<li>使用了一个网络服务比如网络照片打印服务，需要授权这个服务访问自己的云存储照片来打印；</li>
<li>……</li>
</ul>
<p>让别人代替我们做一些事情，这就涉及到了<strong>授权（Authorization）</strong>。</p>
<p>当需要泊车员泊车时，需要我们给泊车员车的钥匙，不过如果把我们自己的钥匙给他的话可能会有风险（泊车员开车跑路了）。所以我们需要给他一个只能用来泊车的钥匙（就是泊车钥匙），这样会更安全一些。</p>
<p>当我们需要云打印服务打印我们的云存储照片时，如果给他我们云存储的账号和密码可能会有安全风险（云打印服务就相当于我们自己了啥都能干），如果只给云打印服务它需要的权限会更安全。</p>
<p>OAuth就是用来保护我们资源（云存储照片等）的一个授权协议，它不管保护的是啥。</p>
<p>OAuth的目的就是，让客户端为资源拥有者访问受保护资源：</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/1.2%20Connecting%20the%20client%20on%20behalf%20of%20the%20resource%20owner.png">

<p>那么，如果没有OAuth，怎么达到授权的目的呢？一些常见的方法如下：</p>
<ol>
<li>客户端复制用户的凭据（比如账号密码，会话cookie等）然后登陆另一个服务；</li>
<li>客户端向用户索要账号密码用于登陆；</li>
<li>为客户端办法一个超级的开发者秘钥（Developer Key）；</li>
<li>给用户一个特殊的密码，专门给第三方服务使用。</li>
</ol>
<p>这些方法都不能很好地保护用户的资源。</p>
<h2 id="0x01-OAuth是什么"><a href="#0x01-OAuth是什么" class="headerlink" title="0x01 OAuth是什么"></a>0x01 OAuth是什么</h2><p>前面提到的几种方法都或多或少地有造成用户资源泄露的风险。</p>
<h3 id="1-1-授权访问"><a href="#1-1-授权访问" class="headerlink" title="1.1 授权访问"></a>1.1 授权访问</h3><p>为了避免这种情况发生，需要用户对客户端授权，客户端拿到授权之后就可以申请访问权限，然后在一定的访问权限下访问用户的资源。</p>
<p>这就是授权访问。流程如下：</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/1.8%20The%20OAuth%20process%2C%20at%20a%20high%20level.png">

<p>整个流程涉及到三个主要步骤：</p>
<ol>
<li>客户端向用户申请授权。具体的方法可能有多种；</li>
<li>客户端拿到授权后就可以向授权服务器申请访问令牌；</li>
<li>客户端拿到令牌后就可以通过这个令牌访问用户资源了。</li>
</ol>
<h3 id="1-2-OAuth中的角色"><a href="#1-2-OAuth中的角色" class="headerlink" title="1.2 OAuth中的角色"></a>1.2 OAuth中的角色</h3><p>在上面的授权流程中涉及到了如下的几个角色：</p>
<ol>
<li><strong>OAuth客户端（Client）</strong>：是代表此资源拥有者访问受保护资源的软件（比如云打印服务）；</li>
<li><strong>受保护资源（Protected Resource）</strong>：需要OAuth访问令牌才能访问的用户资源（比如云存储服务中的照片）；</li>
<li><strong>资源拥有者（Resource Owner）</strong>：就是有权将访问权限授权给客户端的用户了；</li>
<li><strong>OAuth授权服务器（Authorization Server）</strong>：是一个HTTP服务器，在OAuth中充当中心角色。</li>
</ol>
<p>授权服务器对资源拥有者和客户端进行身份认证，让资源拥有者对客户端授权、为客户端颁发令牌。</p>
<h3 id="1-3-OAuth中的组件"><a href="#1-3-OAuth中的组件" class="headerlink" title="1.3 OAuth中的组件"></a>1.3 OAuth中的组件</h3><p>除了四种角色外，OAuth还依赖如下几种组件：</p>
<ol>
<li><strong>授权许可（Authorization Grant）</strong>：授权许可是客户端获取用户授权的方法（grant_type）；</li>
<li><strong>访问令牌（Access Token）</strong>：授权服务器颁发给客户端，有了令牌才可以访问受保护的资源；</li>
<li><strong>权限范围（Scopes）</strong>：表示一组受保护资源的权限。可以对令牌限制具体的权限范围；</li>
<li><strong>刷新令牌（Refresh Token）</strong>：令牌可能会过期，这时可以用刷新令牌获取新的令牌。</li>
</ol>
<h3 id="1-4-一个完整过程"><a href="#1-4-一个完整过程" class="headerlink" title="1.4 一个完整过程"></a>1.4 一个完整过程</h3><p>下面通过一个完整的过程（常见的授权码许可类型）来看看整个流程中每个角色以及组件的作用。</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/2.1%20The%20authorization%20code%20grant%20in%20detail.png">

<ol start="0">
<li>资源拥有者（用户）登录客户端，希望客户端代替自己做一些事情；</li>
<li>客户端发现完成这件事情需要访问自己没有权限的资源，所以将资源拥有者重定向到授权服务器，在请求中附带一个授权请求以及所需要的权限，同时在请求中还会包含自己的身份信息；</li>
<li>授权服务器接收到请求后对客户端进行校验，通过后会要求用户进行身份认证。这对确认资源拥有者的身份以及能向客户端授予哪些权限很重要；</li>
<li>资源拥有者身份认证直接在用户（浏览器）和授权服务器之间进行，客户端不可见；</li>
<li>用户进行授权，同时还可以缩减客户端申请的权限范围。同时授权服务器还可以保存授权决策，以便下一次使用；</li>
<li>然后授权服务器将用户重定向到客户端，这里就会有客户端需要的授权码（code）；</li>
<li>客户端收到授权码之后，就可以直接发送给授权服务器来获取访问令牌了。这个过程不需要资源拥有者的参与；</li>
<li>授权服务器收到请求后会进行各种校验，如果有效就会颁发访问令牌（或许还有刷新令牌）；</li>
<li>客户端拿到访问令牌之后，就可以把这个访问令牌发送给受保护资源进行访问了；</li>
<li>最后，受保护资源会对访问令牌进行校验，有效的话就提供资源。</li>
</ol>
<h3 id="1-5-交互：后端信道、前端信道"><a href="#1-5-交互：后端信道、前端信道" class="headerlink" title="1.5 交互：后端信道、前端信道"></a>1.5 交互：后端信道、前端信道</h3><p>在OAuth的交互中，使用的是HTTP协议，不过并不所有的交互都是通过HTTP请求和响应完成的。</p>
<h4 id="1-5-1-前端信道"><a href="#1-5-1-前端信道" class="headerlink" title="1.5.1 前端信道"></a>1.5.1 前端信道</h4><p>在整个流程中有一些步骤中的组件不能直接通信，比如客户端通过用户向授权服务器发送授权请求，以及授权服务器返回用户的授权结果的时候，需要重定向。</p>
<p>这个时候需要浏览器作为媒介，隔离了浏览器两端的会话，实现了跨安全域工作。</p>
<p>比如，如果需要用户向其中一个组件进行身份认证，并不需要将用户凭据暴露给另一方。</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/2.12%20Front-channel%20communication.png">

<p>两个不直接交互的组件进行通信就需要用到重定向了：</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/2.13%20Parts%20of%20a%20front-channel%20request%20and%20response.png">

<p>通过这两个重定向，就完成了客户端向授权服务器间接发送的授权请求以及授权服务器间接返回给客户端的授权结果。</p>
<p>不过通过前端信道发送的请求都可被浏览器访问，那就有在最终请求发送前被篡改的可能，所以<strong>OAuth限制了可以通过前端信道传输的信息类别，并确保只要是通过前端信道传输的信息，就不能在授权任务中单独使用</strong>（比如授权码）。</p>
<h4 id="1-5-2-后端信道"><a href="#1-5-2-后端信道" class="headerlink" title="1.5.2 后端信道"></a>1.5.2 后端信道</h4><p>除了上面通过前端信道进行的交互外，OAuth使用的都是直接的HTTP请求和响应来完成通信的。</p>
<p>这就是后端信道。比如客户端向授权服务器申请访问令牌以及客户端使用访问令牌访问受保护资源：</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/2.11%20Back-channel%20communication.png">

<h2 id="0x02-构建OAuth环境"><a href="#0x02-构建OAuth环境" class="headerlink" title="0x02 构建OAuth环境"></a>0x02 构建OAuth环境</h2><p>OAuth中有四个角色：客户端、受保护资源、资源拥有者和授权服务器。</p>
<p>其中资源拥有者就是用户，所以构建一个OAuth环境所需要的构建的就是客户端、受保护资源和授权服务器。</p>
<h3 id="2-1-构建简单的OAuth客户端"><a href="#2-1-构建简单的OAuth客户端" class="headerlink" title="2.1 构建简单的OAuth客户端"></a>2.1 构建简单的OAuth客户端</h3><p>关注的点有：</p>
<ul>
<li>客户端不需要理解访问令牌，令牌对客户端是透明的；</li>
<li>客户端需要提前在授权服务器上进行注册，便于身份校验；</li>
<li>客户端在获取用户授权的过程中是通过两个重定向完成的（需要提供一个redirect_uri）；</li>
<li>拿到授权码之后客户端可以直接通过后端信道获取令牌并访问受保护资源；</li>
<li>客户端向受保护资源出示访问令牌的方式有三种：Authorization头部、form表单和URL参数；</li>
<li>客户端可以通过刷新令牌获取新的访问令牌而不需要用户重新授权；</li>
<li>为了添加跨站保护，可以添加state参数并对返回结果进行校验。</li>
</ul>
<h3 id="2-2-构建简单的OAuth受保护资源"><a href="#2-2-构建简单的OAuth受保护资源" class="headerlink" title="2.2 构建简单的OAuth受保护资源"></a>2.2 构建简单的OAuth受保护资源</h3><p>大多数实现中，将受保护资源和授权服务器放在一起。</p>
<p>关注的点有：</p>
<ul>
<li>建议支持通过三种方式获取访问令牌；</li>
<li>得到访问令牌之后对其进行校验；</li>
<li>可以根据访问令牌提供内容；</li>
<li>令牌尽量不出现在日志中。</li>
</ul>
<h3 id="2-3-构建简单的OAuth授权服务器"><a href="#2-3-构建简单的OAuth授权服务器" class="headerlink" title="2.3 构建简单的OAuth授权服务器"></a>2.3 构建简单的OAuth授权服务器</h3><p>授权服务器关注的点有：</p>
<ul>
<li>管理客户端的注册；</li>
<li>一个授权端点，对客户端进行授权；</li>
<li>一个令牌端点，向客户端颁发令牌；</li>
<li>还可以支持刷新令牌以及令牌的权限范围。</li>
</ul>
<h3 id="2-4-授权许可类型"><a href="#2-4-授权许可类型" class="headerlink" title="2.4 授权许可类型"></a>2.4 授权许可类型</h3><p>客户端为了获得访问令牌需要用户的授权。</p>
<p>除了之前的授权码许可类型，达到这一授权的方式也有多种。</p>
<h4 id="2-4-1-隐式许可类型"><a href="#2-4-1-隐式许可类型" class="headerlink" title="2.4.1 隐式许可类型"></a>2.4.1 隐式许可类型</h4><p>对于完全运行于浏览器中的应用，可以使用隐式许可类型：</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/6.1%20The%20implicit%20grant%20type.png">

<ul>
<li>隐式许可类型只通过前端信道和授权服务器通信；</li>
<li>默认获取了用户的授权，所以拿到的直接就是访问令牌了；</li>
<li>response_type=token。</li>
</ul>
<h4 id="2-4-2-客户端凭据许可类型"><a href="#2-4-2-客户端凭据许可类型" class="headerlink" title="2.4.2 客户端凭据许可类型"></a>2.4.2 客户端凭据许可类型</h4><p>如果没有明确的资源拥有者，或对于客户端来说资源拥有者不可区分。</p>
<p>比如后端系统之间的直接通信（不涉及浏览器，无法重定向）。</p>
<p>就可以通过客户端凭据许可类型获取授权了：</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/6.2%20The%20client%20credentials%20grant%20type.png">

<ul>
<li>客户端只通过后端信道与授权服务器通信；</li>
<li>客户端直接向授权服务器进行身份认证，授权服务器也直接颁发令牌；</li>
<li>客户端可以随时获取令牌，所以无需刷新令牌；</li>
<li>grant_type=client_credentials。</li>
</ul>
<h4 id="2-4-3-资源拥有者凭据许可类型"><a href="#2-4-3-资源拥有者凭据许可类型" class="headerlink" title="2.4.3 资源拥有者凭据许可类型"></a>2.4.3 资源拥有者凭据许可类型</h4><p>如果资源拥有者在授权服务器上有纯文本的账号密码，那么客户端可以向用户索要凭据，然后换取令牌：</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/6.3%20The%20resource%20owner%20credentials%20grant%20type.png">

<ul>
<li>客户端索要用户的凭据，和用户交互的是客户端，而不是授权服务器；</li>
<li>只是用后端信道，直接获取访问令牌；</li>
<li>其实这就是中间人攻击，不建议使用；</li>
<li>grant_type=password。</li>
</ul>
<h4 id="2-4-4-断言许可类型"><a href="#2-4-4-断言许可类型" class="headerlink" title="2.4.4 断言许可类型"></a>2.4.4 断言许可类型</h4><p>断言许可类型是OAuth的一个扩展许可类型。</p>
<p>客户端会得到一个结构化的且被加密保护的信息，叫做断言。</p>
<p>客户端可以通过向授权服务器出示这个断言获取令牌：</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/6.5%20The%20assertion%20grant%20type%20family.png">

<ul>
<li>断言许可类型使用用后端信道，直接获取令牌；</li>
<li>仅用于有限的环境中，通常是企业。</li>
</ul>
<h4 id="2-4-5-选择合适的许可类型"><a href="#2-4-5-选择合适的许可类型" class="headerlink" title="2.4.5 选择合适的许可类型"></a>2.4.5 选择合适的许可类型</h4><p>可以通过下面的流程来选择一个合适的许可类型：</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/6.6%20Choosing%20the%20right%20grant%20type.png">

<ul>
<li><strong>客户端是否代表某个资源拥有者？</strong>也就是说客户端区分具体用户吗？如果区分，那就从授权码、隐式或资源拥有者凭据中选择；否则在客户端凭据或断言中选择；</li>
<li>客户端代表某个用户：<strong>客户端可以对用户重定向吗？</strong>如果能，就选择隐式许可类型或授权码；如果不能，就只能选择资源拥有者凭据许可类型了；</li>
<li>客户端可以对用户重定向：<strong>客户端是否完全运行在浏览器中？</strong>如果是，选择隐式许可类型；如果不是，选择授权码许可类型；</li>
<li>对于授权码许可类型：如果客户端是原生应用的话，还应该在授权码的基础上添加动态注册（DynReg）或代码交换证明秘钥（PKCE）；</li>
<li>客户端不代表某个用户：<strong>客户端是否代表自己？</strong>这时客户端不针对单个的用户，选择客户端凭据许可类型；</li>
<li>客户端既不代表某个用户也不代表自己，但是<strong>在权威第三方的指示下运行</strong>，选择断言许可类型。</li>
</ul>
<h3 id="2-5-客户端的类型"><a href="#2-5-客户端的类型" class="headerlink" title="2.5 客户端的类型"></a>2.5 客户端的类型</h3><p>在前面一节中已经对不同类型的客户端有了一个简单的认识了，这里详细看看客户端的类型。</p>
<h4 id="2-5-1-Web应用"><a href="#2-5-1-Web应用" class="headerlink" title="2.5.1 Web应用"></a>2.5.1 Web应用</h4><p>就是常见的Web服务器，通常使用cookie与浏览器保持连接。</p>
<ul>
<li>可以充分利用前端信道和后端信道；</li>
<li>可以使用授权码、客户端凭据或断言等许可类型；</li>
<li>不适合使用隐式许可类型。</li>
</ul>
<h4 id="2-5-2-浏览器应用"><a href="#2-5-2-浏览器应用" class="headerlink" title="2.5.2 浏览器应用"></a>2.5.2 浏览器应用</h4><p>一般使用JavaScript，完全运行在浏览器中。</p>
<ul>
<li>只能使用前端信道；</li>
<li>适合隐式许可类型。</li>
</ul>
<h4 id="2-5-3-原生应用"><a href="#2-5-3-原生应用" class="headerlink" title="2.5.3 原生应用"></a>2.5.3 原生应用</h4><p>这种客户端是运行在用户终端上的应用，需要将软件编译然后安装到用户的终端上。</p>
<ul>
<li>容易使用后端信道；</li>
<li>可以在原生应用中嵌入浏览器来使用前端信道；</li>
<li>对于移动应用来说，重定向的URI可以使用自定义的格式。</li>
</ul>
<h4 id="2-5-4-处理秘钥"><a href="#2-5-4-处理秘钥" class="headerlink" title="2.5.4 处理秘钥"></a>2.5.4 处理秘钥</h4><p>客户端秘钥的作用就是让客户端向授权服务器进行身份认证。</p>
<p>在OAuth 1中，不管什么类型的客户端，都要有自己的秘钥，不过对于原生应用和浏览器应用来说做不到这点。</p>
<p>这是因为，秘密有两种：</p>
<ul>
<li>配置期间秘密（configuration time secret）：客户端的每个副本中都一样；</li>
<li>运行时秘密（runtime secret）：每个客户端的实例都不一会。</li>
</ul>
<p>对于客户端秘钥来说，它属于配置期间秘密，因为它唯一标识客户端。</p>
<p>而访问令牌、刷新令牌和授权码属于运行时秘密。</p>
<p>OAuth 2.0 不要求所有客户端都有客户端秘钥，而是将客户端分为两种：</p>
<ul>
<li>公开客户端（public clients）：不能保持配置期间秘密，因为这种秘密都会以某种方式暴露给最终用户，客户端有多个实例，每个实例都可以获取这个秘密。所以公开客户端没有客户端秘钥，比如绝大多数的浏览器应用和原生应用；</li>
<li>保密客户端（confidential clients）：能够保持客户端秘钥，每个实例有独立的配置信息，包括client_id和client_secret，最终用户难以获得。比如最常见的Web应用，它运行在Web服务器上。</li>
</ul>
<p>可以通过动态注册，将公开客户端的配置期间秘密转化成运行时秘密。</p>
<h2 id="0x03-OAuth-2-0-的实现与漏洞"><a href="#0x03-OAuth-2-0-的实现与漏洞" class="headerlink" title="0x03 OAuth 2.0 的实现与漏洞"></a>0x03 OAuth 2.0 的实现与漏洞</h2><p>这里展示了部署OAuth系统不当造成的一些危害，以及如何避免。</p>
<h3 id="3-1-保护客户端"><a href="#3-1-保护客户端" class="headerlink" title="3.1 保护客户端"></a>3.1 保护客户端</h3><p>这里介绍一下针对客户端的常见攻击，以及如何防御。</p>
<h4 id="3-1-1-针对客户端的CSRF攻击"><a href="#3-1-1-针对客户端的CSRF攻击" class="headerlink" title="3.1.1 针对客户端的CSRF攻击"></a>3.1.1 针对客户端的CSRF攻击</h4><p>先看看什么是CSRF攻击：</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/7.2%20Example%20of%20OAuth%20CSRF%20attack.png">

<ol>
<li><p>攻击者通过正常途径获取一个授权码或者伪造一个授权码；</p>
</li>
<li><p>攻击者设法让用户的客户端使用攻击者的授权码。比如：</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://oauthclient.com/callback?code<span class="token punctuation">=</span>ATTACKER_AUTHORIZATION_CODE<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>这样，资源拥有者的客户端就和攻击者的授权码产生了联系。</p>
</li>
</ol>
<p>客户端的应对措施是使用一个难以猜测的state（至少32位随机字符串）参数并进行校验。</p>
<h4 id="3-1-2-客户端凭据失窃"><a href="#3-1-2-客户端凭据失窃" class="headerlink" title="3.1.2 客户端凭据失窃"></a>3.1.2 客户端凭据失窃</h4><p>不同类型的客户端对客户端凭据：</p>
<ul>
<li>Web应用可以将client_secret安全地存储在服务器上；</li>
<li>浏览器应用不具备保存client_secret的能力；</li>
<li>对于原生应用，应该动态注册生成client_id和client_secret。</li>
</ul>
<p>客户端需要保护好client_secret不外漏。</p>
<h3 id="3-2-保护受保护资源"><a href="#3-2-保护受保护资源" class="headerlink" title="3.2 保护受保护资源"></a>3.2 保护受保护资源</h3><ul>
<li>防止跨站脚本（XSS）攻击：过滤不可信数据+选择合适的Content-Type；</li>
<li>支持隐式许可：使用同源策略；</li>
<li>对客户端进行认证；</li>
<li>尽可能多地对客户端传过来的token进行校验；</li>
<li>尽量缩小令牌的权限范围，遵循集合最小化原则。</li>
</ul>
<h3 id="3-3-保护授权服务器"><a href="#3-3-保护授权服务器" class="headerlink" title="3.3 保护授权服务器"></a>3.3 保护授权服务器</h3><p>授权服务器处于系统的中心位置，保障它的安全更加复杂。</p>
<h4 id="3-3-1-会话劫持"><a href="#3-3-1-会话劫持" class="headerlink" title="3.3.1 会话劫持"></a>3.3.1 会话劫持</h4><p>记住：<strong>授权码只能使用一次，使用之后立即销毁。</strong></p>
<p>同时，赋予授权码更多的信息，比如绑定对应的客户端client_id并进行校验等。</p>
<h4 id="3-3-2-客户端假冒"><a href="#3-3-2-客户端假冒" class="headerlink" title="3.3.2 客户端假冒"></a>3.3.2 客户端假冒</h4><p>授权服务器需要对客户端进行严格管理，防止客户端假冒。</p>
<p>应对措施有：</p>
<ul>
<li>严格校验redirect_uri；</li>
<li>对授权码和令牌的生成都添加客户端的详细信息；</li>
<li>增加额外不可预测参数（比如微信第三方平台授权的ticket推送）;</li>
<li>限制客户端调用的IP名单。</li>
</ul>
<h2 id="0x04-更进一步"><a href="#0x04-更进一步" class="headerlink" title="0x04 更进一步"></a>0x04 更进一步</h2><p>接下来从令牌格式和用户身份认证两方面深入了解一下OAuth 2.0。</p>
<h3 id="4-1-OAuth令牌"><a href="#4-1-OAuth令牌" class="headerlink" title="4.1 OAuth令牌"></a>4.1 OAuth令牌</h3><p>令牌就是一种特殊的秘钥。</p>
<p>在前面的流程中，使用的令牌都是Bearer令牌，也就是一个长的随机字符串。</p>
<p>授权服务器和受保护资源都需要可以访问令牌的详细信息来进行校验，可以通过共享数据库的方式来达到这个目的。</p>
<p>不过有的时候受保护资源和授权服务器不能共享数据库。</p>
<p>这时就需要结构化令牌或令牌内省了。</p>
<h4 id="4-1-1-结构化令牌JWT"><a href="#4-1-1-结构化令牌JWT" class="headerlink" title="4.1.1 结构化令牌JWT"></a>4.1.1 结构化令牌JWT</h4><p>结构化令牌将所有必要的信息放在令牌中，这样授权服务器就可以间接和受保护资源沟通了。</p>
<p>JWT（JSON Web Token）的格式如下：</p>
<pre class="line-numbers language-shell"><code class="language-shell"><header>.<payload>.<signature><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>比如：</p>
<pre><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjkwMDEvIiwic3ViIjoiOVhFMy1KSTM0LTAwMTMyQSIsImF1ZCI6Imh0dHA6Ly9sb2NhbGhvc3Q6OTAwMi8iLCJpYXQiOjE0NjcyNTEwNzMsImV4cCI6MTQ2NzI1MTM3MywianRpIjoiaEZLUUpSNmUifQ.WqRsY03pYwuJTx-9pDQXftkcj7YbRn95o-16NHrVugg</code></pre><p>通过“.”将JWT分成了三个部分，每一部分都是一个JSON结构信息的Base64编码，里面存储了所有详细的信息。</p>
<p>这些信息也会发给客户端，但是客户端不需要理解。</p>
<p>受保护资源需要理解JWT，并对客户端传来的token进行校验。</p>
<h4 id="4-1-2-令牌内省（Token-Introspection）"><a href="#4-1-2-令牌内省（Token-Introspection）" class="headerlink" title="4.1.2 令牌内省（Token Introspection）"></a>4.1.2 令牌内省（Token Introspection）</h4><p>JWT的问题就是尺寸太大了。</p>
<p>另一种不需要共享数据库的方案就是令牌内省。</p>
<p>在原来Bearer的基础上，授权服务器可以提供一个获取令牌信息的接口，这样受保护资源受到客户端的令牌之后调用授权服务器的接口来查看令牌的详细信息，并进行校验。</p>
<p>缺点是增加了网络流量。不过受保护资源可以缓存一下令牌的详细信息。</p>
<h4 id="4-1-3-内省-JWT"><a href="#4-1-3-内省-JWT" class="headerlink" title="4.1.3 内省+JWT"></a>4.1.3 内省+JWT</h4><p>还可以将两个方案组合到一起，在JWT中只存储基本信息。</p>
<h4 id="4-1-4-令牌撤回"><a href="#4-1-4-令牌撤回" class="headerlink" title="4.1.4 令牌撤回"></a>4.1.4 令牌撤回</h4><p>之前所有关于令牌的方案中，都有一个有效期，令牌只要颁发并在有效期内都可以使用。</p>
<p>还可以在这个基础上添加令牌撤回的功能。</p>
<p>实现起来也很简单，只需要在授权服务器上添加一个撤回接口即可。</p>
<h4 id="4-1-5-OAuth令牌的生命周期"><a href="#4-1-5-OAuth令牌的生命周期" class="headerlink" title="4.1.5 OAuth令牌的生命周期"></a>4.1.5 OAuth令牌的生命周期</h4><p>综合前面的所有内容，下图展示了令牌的整个生命周期：</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/11.4%20The%20OAuth%20token%20lifecycle.png">

<h3 id="4-2-使用OAuth-2-0-进行身份认证"><a href="#4-2-使用OAuth-2-0-进行身份认证" class="headerlink" title="4.2 使用OAuth 2.0 进行身份认证"></a>4.2 使用OAuth 2.0 进行身份认证</h3><p><strong>OAuth不是身份认证协议，不过可以用来构建一个。</strong></p>
<h4 id="4-2-1-OAuth-2-0-与身份认证"><a href="#4-2-1-OAuth-2-0-与身份认证" class="headerlink" title="4.2.1 OAuth 2.0 与身份认证"></a>4.2.1 OAuth 2.0 与身份认证</h4><p>什么是身份认证？身份认证会告诉应用，当前的用户是谁以及是否正在使用此应用。</p>
<p>但是OAuth 2.0 本身不提供任何关于用户的信息，它只是获取token，使用token。</p>
<p>至于是谁授权的以及用户是不是存在，它一无所知。</p>
<p>但是可以基于OAuth 2.0 来构建一个身份认证协议。</p>
<h4 id="4-2-2-OAuth到身份认证协议的映射"><a href="#4-2-2-OAuth到身份认证协议的映射" class="headerlink" title="4.2.2 OAuth到身份认证协议的映射"></a>4.2.2 OAuth到身份认证协议的映射</h4><p>在身份认证协议中，需要添加下面的角色：</p>
<ul>
<li>身份提供方（identity provider, IdP）：提供身份信息的一方（比如QQ微信）；</li>
<li>登录依赖方（relying party, RP）：依赖用户身份登录的一方（比如通过QQ微信登录的第三方应用）。</li>
</ul>
<p>为了基于OAuth 2.0 构建一个身份认证协议，需要对角色进行映射。</p>
<p>很自然的想法就是，身份提供方由于提供了用户的身份信息，相当于一个资源服务器。</p>
<p>同时身份提供方需要各种登录校验，因此也是一个授权服务器。</p>
<p>而登录依赖方就相当于客户端：</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/13.2%20Making%20an%20authentication%20protocol%20out%20of%20OAuth%2C%20more%20successfully.png">

<p>有了这个映射就可以基于OAuth 2.0 设计一个身份认证协议了，不过还需要在原来访问令牌的基础上添加一个ID令牌，用来携带有关身份认证事件本身的信息：</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/13.3%20Components%20of%20an%20OAuth-based%20authentication%20and%20identity%20protocol.png">

<h4 id="4-2-3-OpenID-Connect"><a href="#4-2-3-OpenID-Connect" class="headerlink" title="4.2.3 OpenID Connect"></a>4.2.3 OpenID Connect</h4><p>OpenID Connect是一个开放标准，它定义了一种使用OAuth 2.0 执行用户身份认证的互通方式。</p>
<p><strong>ID令牌</strong></p>
<p>OpenID Connect的ID令牌是一个经过签名的JWT，和访问令牌一起提供给客户端。</p>
<p>不过ID令牌是需要RP解析的。</p>
<p>这个ID令牌包含了关于身份认证会话的神明，包括：</p>
<ul>
<li>用户标识符（sub）；</li>
<li>令牌颁发者URL（iss）；</li>
<li>RP的客户端ID（aud）；</li>
<li>令牌到期时间戳（exp）；</li>
<li>颁发令牌时间戳（iat）。</li>
</ul>
<p>RP客户端根据这些信息足以登录了。</p>
<p>如果想获取更多关于用户的信息（比如名称、头像等），可以通过访问令牌到身份提供方处拉取。</p>
<img src="https://deuterium-figure-1251214161.cos.ap-beijing.myqcloud.com/blogs/CS/oauth/16.1%20OAuth-tan%21%20We%20dare%20you%20to%20access%20the.png">
            </div>
            <hr/>

            



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/oauth/">
                                    <span class="chip bg-color">oauth</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/generate-a-random-string-in-go/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/7.jpg" class="responsive-img" alt="Generate a random string in Go">
                        
                        <span class="card-title">Generate a random string in Go</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
如何高效地产生一个随机字符串？这是一个简单的问题，但是简单的问题也有极致的做法。这个问题是StackOverflow上的一个问题，How to generate a random string of a fixed length in G
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-11-10
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/programming/" class="post-category">
                                    programming
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/go/">
                        <span class="chip bg-color">go</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/data-science-part-1-basic-r/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="Data Science (Part 1): Basic R">
                        
                        <span class="card-title">Data Science (Part 1): Basic R</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            1. 开始吧1.1 安装包与导入包# installing the dslabs package
install.packages("dslabs")

# loading the dslabs package into the R ses
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-09-26
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/programming/" class="post-category">
                                    programming
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/r/">
                        <span class="chip bg-color">r</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

    
<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;You Will See...</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="http://deuterium.fun" target="_blank">Valineliu</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link ">


    <a href="mailto:1749118121@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    

    

    

    

    

    
    
    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
